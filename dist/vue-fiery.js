!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.VueFiery=r():e.VueFiery=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,r),o.loaded=!0,o.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(1);r.default=n.default},function(e,r,t){"use strict";function n(e,r,t){for(var n in r){var o=r[n];y(e,o),t&&e.$delete(t,n)}}function o(e){return function(r,t){return i(e,x(e,r,t))}}function i(e,r){var t=r.source.where?r.options.map?s:u:f;return t(e,r)}function s(e,r){var t=r.options,o=t.query?t.query(r.source):r.source;return t.once?r.promise=o.get(t.onceOptions).then(function(o){var i=r.target,s={};for(var u in i)s[u]=i[u];o.forEach(function(t){var n=i[t.id],o=d(e,r,t,n);e.$set(i,t.id,o),delete s[t.id]},t.onError),n(e,s,i),t.onSuccess(i)}).catch(t.onError):r.off=o.onSnapshot(t.liveOptions,function(n){var o=r.target;n.docChanges().forEach(function(t){var n=t.doc;switch(t.type){case"modified":case"added":var i=o[n.id],s=d(e,r,n,i);e.$set(o,n.id,s);break;case"removed":y(e,o[n.id]),e.$delete(o,n.id)}},t.onError),t.onSuccess(o)},t.onError),r.target}function u(e,r){var t=r.options,o=t.query?t.query(r.source):r.source;return t.once?r.promise=o.get(t.onceOptions).then(function(o){for(var i=r.target,s={},u=0;u<i.length;u++){var f=i[u];s[f[F]]=f}i.splice(0,i.length),o.forEach(function(t){var n=s[t.id],o=d(e,r,t,n);i.push(o),delete s[o[F]]},t.onError),n(e,s),t.onSuccess(i)}).catch(t.onError):r.off=o.onSnapshot(t.liveOptions,function(n){var o=r.target;n.docChanges().forEach(function(t){var n=t.doc;switch(t.type){case"added":var i=d(e,r,n);o.splice(t.newIndex,0,i);break;case"removed":o.splice(t.oldIndex,1);break;case"modified":var s=o[t.oldIndex],u=d(e,r,n,s);t.oldIndex!==t.newIndex?(o.splice(t.oldIndex,1),o.splice(t.newIndex,0,u)):o.splice(t.newIndex,1,u)}},t.onError),t.onSuccess(o)},t.onError),r.target}function f(e,r){var t=r.source,n=r.options;return n.once?r.promise=t.get(n.onceOptions).then(function(t){c(e,r,t)}).catch(n.onError):r.off=t.onSnapshot(n.liveOptions,function(t){c(e,r,t)},n.onError),r.target}function c(e,r,t){var n=r.options;t.exists?(r.target=d(e,r,t,r.target),n.reset&&n.property&&(e[n.property]=r.target),n.onSuccess(r.target)):n.onMissing()}function a(e,r){var t,n=e.data(),o=V.isObject(n)?n:(t={},t[r.propValue]=n,t);return o&&r.key&&(o[r.key]=e.id),o}function d(e,r,t,n){var o=r.options,s=o.property,u=!!n,f=!(!o.reset||!s),c=a(t,o);if(!n||f){if(n&&o.sub)for(var d in o.sub)n[d]&&(c[d]=n[d]);n=o.type?p(e,new o.type,c):c}else p(e,n,c);if(n[F]||(n[F]=l(e,o,t)),!u&&o.record){var y=o.recordOptions;y.set&&(n[y.set]=function(r){return E.call(e,this,r)}),y.update&&(n[y.update]=function(r){return O.call(e,this,r)}),y.remove&&(n[y.remove]=function(r){return void 0===r&&(r=!1),w.call(e,this,r)}),y.ref&&(n[y.ref]=function(r){return j.call(e,this,r)})}if(!u&&o.sub)for(var d in o.sub){var v=o.sub[d],h=t.ref.path+M+d,b=x(e,t.ref.collection(d),v,h,!0);n[d]=i(e,b)}return n}function p(e,r,t){for(var n in t)e.$set(r,n,t[n]);return r}function y(e,r){var t=m(e,r),n=t.path,o=t.options;if(o.sub){var i=e.$fiery;for(var s in o.sub){var u=n+M+s,f=i.entry[u];f&&($(f),delete i.entry[u],"number"==typeof f.index&&(i.entryList[f.index]=null,delete f.index)),v(r[s],function(r){y(e,r)})}}}function v(e,r){if(V.isArray(e)){for(var t=0;t<e.length;t++)r(e[t],t,e);return!0}if(V.isObject(e)){for(var n in e)r(e[n],n,e);return!0}return!1}function l(e,r,t){return h(e,t)+L+r.id+L+t.ref.path}function h(e,r){var t=r._firestore,n=t._databaseId,o=n.database+A+n.projectId,i=e.$fiery,s=i.storeIdToKey[o];return s||(s=++i.storeKeyNext,i.stores[s]=t,i.storeIdToKey[o]=s),s}function b(e,r,t){if(r&&V.isObject(r)||(r={}),V.isFunction(r.onError)||(r.onError=function(e){}),V.isFunction(r.onMissing)||(r.onMissing=function(){}),V.isFunction(r.onSuccess)||(r.onSuccess=function(e){}),V.isFunction(r.onRemove)||(r.onRemove=function(){}),r.liveOptions||(r.liveOptions={}),r.propValue||(r.propValue=_),r.recordOptions||(r.recordOptions={set:q,update:N,remove:C,ref:P}),r.exclude){if(V.isArray(r.exclude)){var n=r.exclude;r.exclude={};for(var o=0;o<n.length;o++)r.exclude[n[o]]=!0}}else r.exclude={},r.key&&(r.exclude[r.key]=!0);var i=r.exclude;if(i[r.propValue]=!0,i[F]=!0,r.sub)for(var s in r.sub){var u=b(e,r.sub[s]);u.property=s,u.parent=r,r.sub[s]=u}if(!r.id){var f=e.$fiery;r.id=++f.optionKeyNext,f.options[r.id]=r}return r}function $(e){e&&e.off&&(e.off(),delete e.off)}function x(e,r,t,n,o){void 0===o&&(o=!1);var i=o?t:b(e,t,r),s=i.property,u=n||s||"",f=e.$fiery,c=e.$fires,a=V.isArraySource(r,i)?[]:{},d=f.entry[u],p={source:r,options:i,target:a};return d&&($(d),p.target=d.target),u&&u in f.entry||(p.index=f.entryList.length,f.entryList.push(p)),u&&(f.entry[u]=p),s&&(c[s]=r),p}function g(e,r,t){var n=t||r.include,o={};if(n)for(var i=0;i<n.length;i++){var s=n[i];s in e&&(o[s]=e[s])}else for(var s in e)s in r.exclude||(o[s]=e[s]);return o}function m(e,r){var t=r[F],n=t.split(L),o=n[0],i=n[1],s=n[2],u=e.$fiery.stores[o],f=e.$fiery.options[parseInt(i)];return{uid:t,path:s,storeKey:o,store:u,optionKey:i,options:f}}function O(e,r){var t=m(this,e),n=t.store,o=t.path,i=t.options;if(n&&o){var s=g(e,i,r);return n.doc(o).update(s)}}function E(e,r){var t=m(this,e),n=t.store,o=t.path,i=t.options;if(n&&o){var s=g(e,i,r);return n.doc(o).set(s)}}function w(e,r){var t=this;void 0===r&&(r=!1);var n=m(this,e),o=n.store,i=n.path,s=n.options;if(o&&i){if(!r&&s.sub)for(var u in s.sub)v(e[u],function(e){t.remove(e)});return o.doc(i).delete()}}function j(e,r){var t=m(this,e),n=t.store,o=t.path;if(n&&o){var i=n.doc(o);return r?i.collection(r):i}}function I(){var e=this;this.$fiery=o(this),this.$fiery.stores={},this.$fiery.storeKeyNext=0,this.$fiery.storeIdToKey={},this.$fiery.options={},this.$fiery.optionKeyNext=0,this.$fiery.entry={},this.$fiery.entryList=[],this.$fiery.update=O.bind(this),this.$fiery.set=E.bind(this),this.$fiery.remove=w.bind(this),this.$fiery.ref=j.bind(this),this.$fiery.getMetadata=function(r){return m(e,r)},this.$fires={}}function S(){this.$fiery.stores={},this.$fiery.entry={},this.$fiery.entryList.forEach($),this.$fiery.entryList=[],this.$fiery=function(){},this.$fires={}}function K(){for(var e=this.$fiery.entryList,r=0;r<e.length;r++){var t=e[r];if(null!==t){var n=t.options;if(!n.parent&&!n.property)for(var o in this)if(this[o]===t.target){n.property=o,this.$fiery.entry[o]=t,this.$fires[o]=t.source;break}}}}function k(e){e.mixin({beforeCreate:I,created:K,beforeDestroy:S})}Object.defineProperty(r,"__esModule",{value:!0});var V=t(2),_=".value",F=".uid",L="///",M="/",A="/",q="$set",N="$update",C="$remove",P="$ref";"undefined"!=typeof window&&window.Vue&&window.Vue.use(k),r.default=k},function(e,r){"use strict";function t(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(e){return"function"==typeof e}function o(e){return e&&e instanceof Array}function i(e,r){return!(!e.where||r.map)}Object.defineProperty(r,"__esModule",{value:!0}),r.isObject=t,r.isFunction=n,r.isArray=o,r.isArraySource=i}])});
//# sourceMappingURL=vue-fiery.js.map