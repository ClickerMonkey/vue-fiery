!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VueFiery=t():e.VueFiery=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.default=n.default},function(e,t,r){"use strict";function n(e){e.mixin({beforeCreate:o.init,created:o.link,beforeDestroy:o.destroy})}Object.defineProperty(t,"__esModule",{value:!0});var o=r(2);t.install=n,"undefined"!=typeof window&&window.Vue&&window.Vue.use(n),t.default=n},function(e,t,r){"use strict";function n(){var e=this;this.$fiery=a.factoryInstance(this),this.$fiery.stores={},this.$fiery.storeKeyNext=0,this.$fiery.storeIdToKey={},this.$fiery.options={},this.$fiery.optionKeyNext=0,this.$fiery.entry={},this.$fiery.entryList=[],this.$fiery.update=c.update.bind(this),this.$fiery.set=c.set.bind(this),this.$fiery.remove=c.remove.bind(this),this.$fiery.ref=c.ref.bind(this),this.$fiery.link=i.bind(this),this.$fiery.destroy=o.bind(this),this.$fiery.getMetadata=function(t){return s.getMetadata(e,t)},this.$fires={}}function o(){this.$fiery.stores={},this.$fiery.entry={},this.$fiery.entryList.forEach(u.closeEntry),this.$fiery.entryList=[],this.$fiery=function(){},this.$fires={}}function i(){for(var e=this.$fiery.entryList,t=0;t<e.length;t++){var r=e[t];if(null!==r){var n=r.options;if(!n.parent&&!n.property)for(var o in this)if(this[o]===r.target){n.property=o,this.$fiery.entry[o]=r,this.$fires[o]=r.source;break}}}}Object.defineProperty(t,"__esModule",{value:!0});var s=r(3),u=r(5),c=r(7),a=r(8);t.init=n,t.destroy=o,t.link=i},function(e,t,r){"use strict";function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function o(e){return"function"==typeof e}function i(e){return e&&e instanceof Array}function s(e){return!!e.where}function u(e,t){if(i(e)){for(var r=0;r<e.length;r++)t(e[r],r,e);return!0}if(n(e)){for(var o in e)t(e[o],o,e);return!0}return!1}function c(e,t){var r=t[f.PROP_UID],n=r.split(f.UID_SEPARATOR),o=n[0],i=n[1],s=n[2],u=e.$fiery.stores[parseInt(o)],c=e.$fiery.options[parseInt(i)];return{uid:r,path:s,storeKey:o,store:u,optionKey:i,options:c}}function a(e,t){if(t.record){var r=t.recordOptions,n=t.recordFunctions;r.set&&(e[r.set]=n.set),r.update&&(e[r.update]=n.update),r.remove&&(e[r.remove]=n.remove),r.ref&&(e[r.ref]=n.ref)}return e}Object.defineProperty(t,"__esModule",{value:!0});var f=r(4);t.isObject=n,t.isFunction=o,t.isArray=i,t.isCollectionSource=s,t.forEach=u,t.getMetadata=c,t.createRecord=a},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROP_VALUE=".value",t.PROP_UID=".uid",t.UID_SEPARATOR="///",t.ENTRY_SEPARATOR="/",t.STORE_SEPARATOR="/",t.RECORD_OPTIONS={set:"$set",update:"$update",remove:"$remove",ref:"$ref"}},function(e,t,r){"use strict";function n(e){e&&e.off&&(e.off(),delete e.off)}function o(e,t,r,o,u){void 0===u&&(u=!1);var c=u?r:s.normalizeOptions(e,r,t),a=c.property,f=o||a||"",d=e.$fiery,p=e.$fires,l=i.isCollectionSource(t)?c.newCollection():c.newDocument(),y=d.entry[f],v={},h={source:t,options:c,target:l,children:v};return y&&(n(y),h.target=y.target),f&&f in d.entry||(h.index=d.entryList.length,d.entryList.push(h)),f&&(d.entry[f]=h),a&&(p[a]=t),h}Object.defineProperty(t,"__esModule",{value:!0});var i=r(3),s=r(6);t.closeEntry=n,t.getEntry=o},function(e,t,r){"use strict";function n(e,t,r){if(t&&i.isObject(t)||(t={}),i.isFunction(t.onError)||(t.onError=function(e){}),i.isFunction(t.onMissing)||(t.onMissing=function(){}),i.isFunction(t.onSuccess)||(t.onSuccess=function(e){}),i.isFunction(t.onRemove)||(t.onRemove=function(){}),t.liveOptions||(t.liveOptions={}),t.propValue||(t.propValue=o.PROP_VALUE),t.recordOptions||(t.recordOptions=o.RECORD_OPTIONS),t.record&&(t.recordFunctions={set:function(t){return s.set.call(e,this,t)},update:function(t){return s.update.call(e,this,t)},remove:function(t){return void 0===t&&(t=!1),s.remove.call(e,this,t)},ref:function(t){return s.ref.call(e,this,t)}}),t.type){var u=t.type;t.newDocument=function(e){return new u}}else t.newDocument||(t.newDocument=function(e){return{}});if(t.newCollection||(t.newCollection=t.map?function(){return{}}:function(){return[]}),t.exclude){if(i.isArray(t.exclude)){var c=t.exclude;t.exclude={};for(var a=0;a<c.length;a++)t.exclude[c[a]]=!0}}else t.exclude={},t.key&&(t.exclude[t.key]=!0);var f=t.exclude;f[t.propValue]=!0,f[o.PROP_UID]=!0;for(var d in t.recordOptions)f[t.recordOptions[d]]=!0;if(t.sub)for(var p in t.sub){var l=n(e,t.sub[p]);l.property=p,l.parent=t,t.sub[p]=l,f[p]=!0}if(!t.id){var y=e.$fiery;t.id=++y.optionKeyNext,y.options[t.id]=t}return t}Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),i=r(3),s=r(7);t.normalizeOptions=n},function(e,t,r){"use strict";function n(e,t,r){var n=r||t.include,o={};if(n)for(var i=0;i<n.length;i++){var s=n[i];s in e&&(o[s]=e[s])}else for(var s in e)s in t.exclude||(o[s]=e[s]);return o}function o(e,t){var r=c.getMetadata(this,e),o=r.store,i=r.path,s=r.options;if(o&&i){var u=n(e,s,t);return o.doc(i).update(u)}}function i(e,t){var r=c.getMetadata(this,e),o=r.store,i=r.path,s=r.options;if(o&&i){var u=n(e,s,t);return o.doc(i).set(u)}}function s(e,t){var r=this;void 0===t&&(t=!1);var n=c.getMetadata(this,e),o=n.store,i=n.path,s=n.options;if(o&&i){if(!t&&s.sub)for(var u in s.sub)c.forEach(e[u],function(e){r.remove(e)});return o.doc(i).delete()}}function u(e,t){var r=c.getMetadata(this,e),n=r.store,o=r.path;if(n&&o){var i=n.doc(o);return t?i.collection(t):i}}Object.defineProperty(t,"__esModule",{value:!0});var c=r(3);t.getValues=n,t.update=o,t.set=i,t.remove=s,t.ref=u},function(e,t,r){"use strict";function n(e,t){var r=t.source.where?t.options.map?u.default:c.default:s.default;return r(e,t)}function o(e){return function(t,r){return n(e,i.getEntry(e,t,r))}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),s=r(9),u=r(11),c=r(12);t.factory=n,t.factoryInstance=o,t.default=n},function(e,t,r){"use strict";function n(e,t){var r=t.source,n=t.options;return n.once?t.promise=r.get(n.onceOptions).then(function(r){o(e,t,r)}).catch(n.onError):t.off=r.onSnapshot(n.liveOptions,function(r){o(e,t,r)},n.onError),t.target}function o(e,t,r){var n=t.options;r.exists?(t.target=i.refreshDocument(e,t,r,t.target),n.reset&&n.property&&(e[n.property]=t.target),n.onSuccess(t.target)):n.onMissing()}Object.defineProperty(t,"__esModule",{value:!0});var i=r(10);t.factory=n,t.handleDocumentUpdate=o,t.default=n},function(e,t,r){"use strict";function n(e,t){var r,n=e.data(),o=d.isObject(n)?n:(r={},r[t.propValue]=n,r);return o&&t.key&&(o[t.key]=e.id),o}function o(e,t,r,o){var s=t.options,u=s.property,a=!(!s.reset||!u),y=n(r,s);if(o)if(a){var v=s.newDocument(y);if(s.sub)for(var h in s.sub)o[h]&&(v[h]=o[h]);d.createRecord(v,s),o=i(e,v,y)}else i(e,o,y);else{var O=c(e,s,r);if(o=s.newDocument(y),o[f.PROP_UID]=O,i(e,o,y),d.createRecord(o,s),s.sub)for(var h in s.sub){var m=s.sub[h],b=r.ref.path+f.ENTRY_SEPARATOR+h,_=p.getEntry(e,r.ref.collection(h),m,b,!0);o[h]=l.factory(e,_)}}return o}function i(e,t,r){for(var n in r)e.$set(t,n,r[n]);return t}function s(e,t,r){for(var n in t){var o=t[n];u(e,o),r&&e.$delete(r,n)}}function u(e,t){var r=d.getMetadata(e,t),n=r.path,o=r.options;if(o.sub){var i=e.$fiery;for(var s in o.sub){var c=n+f.ENTRY_SEPARATOR+s,a=i.entry[c];a&&(p.closeEntry(a),delete i.entry[c],"number"==typeof a.index&&(i.entryList[a.index]=null,delete a.index)),d.forEach(t[s],function(t){u(e,t)})}}}function c(e,t,r){return a(e,r)+f.UID_SEPARATOR+t.id+f.UID_SEPARATOR+r.ref.path}function a(e,t){var r=t._firestore,n=r._databaseId,o=n.database+f.STORE_SEPARATOR+n.projectId,i=e.$fiery,s=i.storeIdToKey[o];return s||(s=++i.storeKeyNext,i.stores[s]=r,i.storeIdToKey[o]=s),s}Object.defineProperty(t,"__esModule",{value:!0});var f=r(4),d=r(3),p=r(5),l=r(8);t.parseDocument=n,t.refreshDocument=o,t.copyData=i,t.destroyDocuments=s,t.destroyDocument=u,t.getDocumentIdentifier=c,t.getStoreKey=a},function(e,t,r){"use strict";function n(e,t){var r=t.options,n=r.query?r.query(t.source):t.source;return r.once?t.promise=n.get(r.onceOptions).then(function(n){var i=t.target,s={};for(var u in i)s[u]=i[u];n.forEach(function(r){var n=i[r.id],u=o.refreshDocument(e,t,r,n);e.$set(i,r.id,u),delete s[r.id]},r.onError),o.destroyDocuments(e,s,i),r.onSuccess(i)}).catch(r.onError):t.off=n.onSnapshot(r.liveOptions,function(n){var i=t.target;n.docChanges().forEach(function(r){var n=r.doc;switch(r.type){case"modified":case"added":var s=i[n.id],u=o.refreshDocument(e,t,n,s);e.$set(i,n.id,u);break;case"removed":o.destroyDocument(e,i[n.id]),e.$delete(i,n.id)}},r.onError),r.onSuccess(i)},r.onError),t.target}Object.defineProperty(t,"__esModule",{value:!0});var o=r(10);t.default=n},function(e,t,r){"use strict";function n(e,t){var r=t.options,n=r.query?r.query(t.source):t.source;return r.once?t.promise=n.get(r.onceOptions).then(function(n){for(var s=t.target,u={},c=0;c<s.length;c++){var a=s[c];u[a[o.PROP_UID]]=a}s.splice(0,s.length),n.forEach(function(r){var n=u[r.id],c=i.refreshDocument(e,t,r,n);s.push(c),delete u[c[o.PROP_UID]]},r.onError),i.destroyDocuments(e,u),r.onSuccess(s)}).catch(r.onError):t.off=n.onSnapshot(r.liveOptions,function(n){var o=t.target;n.docChanges().forEach(function(r){var n=r.doc;switch(r.type){case"added":var s=i.refreshDocument(e,t,n);o.splice(r.newIndex,0,s);break;case"removed":o.splice(r.oldIndex,1);break;case"modified":var u=o[r.oldIndex],c=i.refreshDocument(e,t,n,u);r.oldIndex!==r.newIndex?(o.splice(r.oldIndex,1),o.splice(r.newIndex,0,c)):o.splice(r.newIndex,1,c)}},r.onError),r.onSuccess(o)},r.onError),t.target}Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),i=r(10);t.factory=n,t.default=n}])});
//# sourceMappingURL=vue-fiery.js.map