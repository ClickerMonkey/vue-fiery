!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VueFiery=t():e.VueFiery=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),o=r(5),i=r(2);function a(e){return"[object Object]"===Object.prototype.toString.call(e)}function s(e){return e&&e instanceof Array}function c(e){return void 0!==e}t.isObject=a,t.isFunction=function(e){return"function"==typeof e},t.isArray=s,t.isDefined=c,t.coalesce=function(e,t){return c(e)?e:t},t.isCollectionSource=function(e){return!!e.where},t.getFields=function(e,t){return e?"string"==typeof e?[e]:e:t},t.forEach=function(e,t){if(s(e)){for(var r=0;r<e.length;r++)t(e[r],r,e);return!0}if(a(e)){for(var n in e)t(e[n],n,e);return!0}return!1},t.getMetadata=function(e){var t=e[n.PROP_UID],r=t.split(n.UID_SEPARATOR),a=r[0],s=r[1];return{uid:t,path:r[2],storeKey:a,store:o.getStoreByKey(a),optionKey:s,options:i.getOptionsByKey(s)}},t.createRecord=function(e,t){var r=t.options;if(r.record){var n=r.recordOptions,o=t.recordFunctions;n.sync&&(e[n.sync]=o.sync),n.update&&(e[n.update]=o.update),n.remove&&(e[n.remove]=o.remove),n.clear&&(e[n.clear]=o.clear),n.getChanges&&(e[n.getChanges]=o.getChanges),n.ref&&(e[n.ref]=o.ref)}return e},t.isEqual=function e(t,r){if(t===r)return!0;if(!t||!r)return!1;if(s(t)&&s(r)){if(t.length!==r.length)return!1;for(var n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}if(a(t)&&a(r)){for(var o in t)if(!e(t[o],r[o]))return!1;for(var o in r)if(!(o in t))return!1;return!0}return!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROP_VALUE=".value",t.PROP_UID=".uid",t.UID_SEPARATOR="///",t.ENTRY_SEPARATOR="/",t.STORE_SEPARATOR="/",t.RECORD_OPTIONS={sync:"$sync",update:"$update",remove:"$remove",ref:"$ref",clear:"$clear",getChanges:"$getChanges"}},function(e,t,r){"use strict";var n=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e};Object.defineProperty(t,"__esModule",{value:!0});var o=r(1),i=r(0);function a(e,r){if(r)for(var n in t.mergeOptions){var o=n,i=t.mergeOptions[o];e[o]=i(e[o],r[o])}}t.globalOptions={defined:{},user:void 0,defaults:{onError:function(e){},onMissing:function(){},onSuccess:function(e){},onRemove:function(){},liveOptions:{},propValue:o.PROP_VALUE,recordOptions:o.RECORD_OPTIONS,newDocument:function(e){return{}}},id:0,map:{}},t.getOptionsByKey=function(e){return t.globalOptions.map[parseInt(e)]},t.getOptions=function e(r,n){if("string"==typeof r){if(!(r in t.globalOptions.defined))throw"The definition "+r+" was not found. You must call VueFiery.define before you use the definition";return e(t.globalOptions.defined[r])}if(r&&i.isObject(r)||(r={}),r.id&&r.id in t.globalOptions.map)return r;if(r.id||(r.id=++t.globalOptions.id,t.globalOptions.map[r.id]=r),r.extends&&a(r,e(r.extends)),a(r,t.globalOptions.user),a(r,t.globalOptions.defaults),n&&!r.shared&&(r.vm=n,n.$fiery.options[r.id]=r),r.type){var s=r.type;r.newDocument=function(e){return new s}}r.newCollection||(r.newCollection=r.map?function(){return{}}:function(){return[]});var c={};if(r.exclude?i.isArray(r.exclude)?i.forEach(r.exclude,function(e,t){return c[e]=!0}):c=r.exclude:r.key&&(c[r.key]=!0),c[r.propValue]=!0,c[o.PROP_UID]=!0,i.forEach(r.recordOptions,function(e,t){return c[e]=!0}),r.exclude=c,r.sub)for(var u in r.sub){var f=e(r.sub[u],n);f.property=u,f.parent=r,r.sub[u]=f,c[u]=!0}return r},t.define=function(e,r){if("string"==typeof e)t.globalOptions.defined[e]=r;else for(var n in e)t.globalOptions.defined[n]=e[n]},t.setGlobalOptions=function(e){t.globalOptions.user=e},t.performMerge=a,t.mergeStrategy={ignore:function(e,t){return e},replace:function(e,t){return i.coalesce(e,t)},chain:function(e,t){return i.isDefined(t)?i.isDefined(e)?function(){t.apply(this,arguments)(e).apply(this,arguments)}:t:e},shallow:function(e,t){return i.isDefined(t)?i.isDefined(e)?n({},t,e):t:e},concat:function(e,t){if(!i.isDefined(t))return e;if(!i.isDefined(e))return t;if(i.isArray(e)&&i.isArray(t)){for(var r=e.concat(t),n={},o=r.length-1;o>=0;o--)r[o]in n?r.splice(o,1):n[r[o]]=!0;return r}},exclude:function(e,r){if(!t.mergeStrategy.concat(e,r)&&e&&r){var n={},o=i.isArray(r),a=i.isArray(e);return i.forEach(r,function(e,t){return e?n[o?e:t]=!0:0}),i.forEach(e,function(e,t){return e?n[a?e:t]=!0:0}),n}}},t.mergeOptions={extends:t.mergeStrategy.ignore,id:t.mergeStrategy.ignore,property:t.mergeStrategy.ignore,parent:t.mergeStrategy.ignore,shared:t.mergeStrategy.ignore,vm:t.mergeStrategy.ignore,key:t.mergeStrategy.replace,query:t.mergeStrategy.replace,map:t.mergeStrategy.replace,once:t.mergeStrategy.replace,reset:t.mergeStrategy.replace,type:t.mergeStrategy.replace,newDocument:t.mergeStrategy.replace,newCollection:t.mergeStrategy.replace,decode:t.mergeStrategy.replace,decoders:t.mergeStrategy.shallow,encoders:t.mergeStrategy.shallow,record:t.mergeStrategy.replace,recordOptions:t.mergeStrategy.replace,recordFunctions:t.mergeStrategy.replace,propValue:t.mergeStrategy.replace,onceOptions:t.mergeStrategy.replace,liveOptions:t.mergeStrategy.replace,include:t.mergeStrategy.concat,exclude:t.mergeStrategy.exclude,onError:t.mergeStrategy.replace,onSuccess:t.mergeStrategy.replace,onMissing:t.mergeStrategy.replace,onRemove:t.mergeStrategy.replace,sub:t.mergeStrategy.shallow}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),o=r(0),i=r(4),a=r(7),s=r(5);function c(e,t){if(t.decode)e=t.decode(e);else if(t.decoders)for(var r in t.decoders)r in e&&(e[r]=t.decoders[r](e[r],e));return e}function u(e,t){var r,n=e.data(),i=o.isObject(n)?n:((r={})[t.propValue]=n,r);return i&&t.key&&(i[t.key]=e.id),i}function f(e,t,r){for(var n in r)e.$set(t,n,r[n]);return t}function d(e,t){var r=o.getMetadata(t),a=r.path,s=r.options;if(s.sub){var c=e.$fiery;for(var u in s.sub){var f=a+n.ENTRY_SEPARATOR+u,l=c.entry[f];l&&(i.closeEntry(l),delete c.entry[f],"number"==typeof l.index&&(c.entryList[l.index]=null,delete l.index)),o.forEach(t[u],function(t){d(e,t)})}}}function l(e,t){return s.getStoreKey(t)+n.UID_SEPARATOR+e.id+n.UID_SEPARATOR+t.ref.path}t.decodeDocument=c,t.encodeDocument=function(e,t,r){var n={},i=o.getFields(r,t.include);if(i)for(var a=0;a<i.length;a++)(s=i[a])in e&&(n[s]=e[s]);else for(var s in e)s in t.exclude||(n[s]=e[s]);if(t.encoders)for(var s in t.encoders)s in n&&(n[s]=t.encoders[s](n[s],e));return n},t.parseDocument=u,t.refreshDocument=function(e,t,r,s){var d=t.options,p=d.property,y=!(!d.reset||!p),g=c(u(r,d),d);if(s)if(y){var v=d.newDocument(g);if(d.sub)for(var h in d.sub)s[h]&&(v[h]=s[h]);o.createRecord(v,t),s=f(e,v,g)}else f(e,s,g);else{var m=l(d,r);if((s=d.newDocument(g))[n.PROP_UID]=m,f(e,s,g),o.createRecord(s,t),d.sub)for(var h in d.sub){var O=d.sub[h],b=r.ref.path+n.ENTRY_SEPARATOR+h,S=i.getEntry(e,r.ref.collection(h),O,b,!0);s[h]=a.factory(e,S)}}return s},t.copyData=f,t.destroyDocuments=function(e,t,r){for(var n in t)d(e,t[n]),r&&e.$delete(r,n)},t.destroyDocument=d,t.getDocumentIdentifier=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(2),i=r(6);function a(e){e&&e.off&&(e.off(),delete e.off)}function s(e){return{sync:function(t){return i.sync.call(e,this,t)},update:function(t){return i.update.call(e,this,t)},remove:function(t){return void 0===t&&(t=!1),i.remove.call(e,this,t)},ref:function(t){return i.ref.call(e,this,t)},clear:function(t){return i.clear.call(e,this,t)},getChanges:function(t,r,n){return i.getChanges.call(e,this,t,r,n)}}}t.closeEntry=a,t.getEntry=function(e,t,r,i,c){void 0===c&&(c=!1);var u=c?r:o.getOptions(r,e),f=n.isCollectionSource(t)?u.newCollection():u.newDocument(),d=s(e),l=u.property,p=i||l||"",y=e.$fiery,g=e.$fires,v=y.entry[p],h={source:t,options:u,target:f,children:{},recordFunctions:d};return v&&(a(v),h.target=v.target),p&&p in y.entry||(h.index=y.entryList.length,y.entryList.push(h)),p&&(y.entry[p]=h),l&&(g[l]=t),h},t.getEntryRecordFunctions=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.stores={keyNext:0,map:{},idToKey:{}},t.getStoreByKey=function(e){return t.stores.map[parseInt(e)]},t.getStoreKey=function(e){var r=e._firestore,o=r._databaseId,i=o.database+n.STORE_SEPARATOR+o.projectId,a=t.stores.idToKey[i];return a||(a=++t.stores.keyNext,t.stores.map[a]=r,t.stores.idToKey[i]=a),a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),o=r(0);t.update=function(e,t){var r=o.getMetadata(e),i=r.store,a=r.path,s=r.options;if(i&&a){var c=n.encodeDocument(e,s,t);return i.doc(a).update(c)}},t.sync=function(e,t){var r=o.getMetadata(e),i=r.store,a=r.path,s=r.options;if(i&&a){var c=n.encodeDocument(e,s,t);return i.doc(a).set(c)}},t.remove=function(e,t){var r=this;void 0===t&&(t=!1);var n=o.getMetadata(e),i=n.store,a=n.path,s=n.options;if(i&&a){if(!t&&s.sub)for(var c in s.sub)o.forEach(e[c],function(e){r.remove(e)});return i.doc(a).delete()}},t.clear=function(e,t){var r=this,n=o.getMetadata(e),i=n.store,a=n.path,s=n.options,c=o.getFields(t);if(i&&a){for(var u=i.doc(a),f={},d=0,l=0,p=c;l<p.length;l++){var y=p[l];if(s.sub&&y in s.sub&&e[y])o.forEach(e[y],function(e){r.remove(e)});else if(y in e){var g=i.app.firebase_;g&&(f[y]=g.firestore.FieldValue.delete(),d++)}}if(d>0)return u.update(f)}},t.getChanges=function(e,t,r,i){var a=o.getMetadata(e),s=a.store,c=a.path,u=a.options,f=o.isFunction(t)?void 0:o.getFields(t),d=f?r:t,l=(f?i:r)||o.isEqual;if(s&&c){var p=n.encodeDocument(e,u,f);return s.doc(c).get().then(function(e){var t=n.parseDocument(e,u),r={},o={},i=!1;for(var a in p){var s=t[a],c=p[a];l(s,c)||(i=!0,r[a]=s,o[a]=c)}d(i,r,o)})}},t.ref=function(e,t){var r=o.getMetadata(e),n=r.store,i=r.path;if(n&&i){var a=n.doc(i);return t?a.collection(t):a}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4),o=r(11),i=r(12),a=r(13);function s(e,t){return(t.source.where?t.options.map?i.default:a.default:o.default)(e,t)}t.factory=s,t.factoryInstance=function(e){return function(t,r){return s(e,n.getEntry(e,t,r))}},t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9);t.default=n.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(10),o=r(2);t.plugin={mergeOptions:o.mergeOptions,mergeStrategy:o.mergeStrategy,define:o.define,setGlobalOptions:o.setGlobalOptions,install:function(e){e.mixin({beforeCreate:n.init,created:n.link,beforeDestroy:n.destroy})}},"undefined"!=typeof window&&window.Vue&&window.Vue.use(t.plugin),t.default=t.plugin},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(4),i=r(2),a=r(7),s=r(6);function c(){n.forEach(this.$fiery.options,function(e){return delete i.globalOptions.map[e.id]}),this.$fiery.stores={},this.$fiery.entry={},this.$fiery.entryList.forEach(o.closeEntry),this.$fiery.entryList=[],this.$fiery.options={},this.$fiery=function(){},this.$fires={}}function u(){for(var e=this.$fiery.entryList,t=0;t<e.length;t++){var r=e[t];if(null!==r){var n=r.options;if(!n.parent&&!n.property)for(var o in this)if(this[o]===r.target){n.property=o,this.$fiery.entry[o]=r,this.$fires[o]=r.source;break}}}}t.init=function(){this.$fiery=a.factoryInstance(this),this.$fiery.stores={},this.$fiery.storeKeyNext=0,this.$fiery.storeIdToKey={},this.$fiery.entry={},this.$fiery.entryList=[],this.$fiery.options={},this.$fiery.update=s.update.bind(this),this.$fiery.sync=s.sync.bind(this),this.$fiery.remove=s.remove.bind(this),this.$fiery.clear=s.clear.bind(this),this.$fiery.getChanges=s.getChanges.bind(this),this.$fiery.ref=s.ref.bind(this),this.$fiery.link=u.bind(this),this.$fiery.destroy=c.bind(this),this.$fiery.getMetadata=n.getMetadata,this.$fires={}},t.destroy=c,t.link=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3);function o(e,t){var r=t.source,n=t.options;return n.once?t.promise=r.get(n.onceOptions).then(function(r){i(e,t,r)}).catch(n.onError):t.off=r.onSnapshot(n.liveOptions,function(r){i(e,t,r)},n.onError),t.target}function i(e,t,r){var o=t.options;r.exists?(t.target=n.refreshDocument(e,t,r,t.target),o.reset&&o.property&&(e[o.property]=t.target),o.onSuccess(t.target)):o.onMissing()}t.factory=o,t.handleDocumentUpdate=i,t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3);t.default=function(e,t){var r=t.options,o=r.query?r.query(t.source):t.source;return r.once?t.promise=o.get(r.onceOptions).then(function(o){var i=t.target,a={};for(var s in i)a[s]=i[s];o.forEach(function(r){var o=i[r.id],s=n.refreshDocument(e,t,r,o);e.$set(i,r.id,s),delete a[r.id]},r.onError),n.destroyDocuments(e,a,i),r.onSuccess(i)}).catch(r.onError):t.off=o.onSnapshot(r.liveOptions,function(o){var i=t.target;o.docChanges().forEach(function(r){var o=r.doc;switch(r.type){case"modified":case"added":var a=i[o.id],s=n.refreshDocument(e,t,o,a);e.$set(i,o.id,s);break;case"removed":n.destroyDocument(e,i[o.id]),e.$delete(i,o.id)}},r.onError),r.onSuccess(i)},r.onError),t.target}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),o=r(3);function i(e,t){var r=t.options,i=r.query?r.query(t.source):t.source;return r.once?t.promise=i.get(r.onceOptions).then(function(i){for(var a=t.target,s={},c=0;c<a.length;c++){var u=a[c];s[u[n.PROP_UID]]=u}a.splice(0,a.length),i.forEach(function(r){var i=s[r.id],c=o.refreshDocument(e,t,r,i);a.push(c),delete s[c[n.PROP_UID]]},r.onError),o.destroyDocuments(e,s),r.onSuccess(a)}).catch(r.onError):t.off=i.onSnapshot(r.liveOptions,function(n){var i=t.target;n.docChanges().forEach(function(r){var n=r.doc;switch(r.type){case"added":var a=o.refreshDocument(e,t,n);i.splice(r.newIndex,0,a);break;case"removed":i.splice(r.oldIndex,1);break;case"modified":var s=i[r.oldIndex],c=o.refreshDocument(e,t,n,s);r.oldIndex!==r.newIndex?(i.splice(r.oldIndex,1),i.splice(r.newIndex,0,c)):i.splice(r.newIndex,1,c)}},r.onError),r.onSuccess(i)},r.onError),t.target}t.factory=i,t.default=i}]).default});