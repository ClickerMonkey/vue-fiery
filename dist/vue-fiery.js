!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.VueFiery=t():e.VueFiery=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1);t.default=n.default},function(e,t,r){"use strict";function n(e){e.mixin({beforeCreate:o.init,created:o.link,beforeDestroy:o.destroy})}Object.defineProperty(t,"__esModule",{value:!0});var o=r(2);t.install=n,"undefined"!=typeof window&&window.Vue&&window.Vue.use(n),t.default=n},function(e,t,r){"use strict";function n(){var e=this;this.$fiery=a.factoryInstance(this),this.$fiery.stores={},this.$fiery.storeKeyNext=0,this.$fiery.storeIdToKey={},this.$fiery.options={},this.$fiery.optionKeyNext=0,this.$fiery.entry={},this.$fiery.entryList=[],this.$fiery.update=u.update.bind(this),this.$fiery.sync=u.sync.bind(this),this.$fiery.remove=u.remove.bind(this),this.$fiery.clear=u.clear.bind(this),this.$fiery.getChanges=u.getChanges.bind(this),this.$fiery.ref=u.ref.bind(this),this.$fiery.link=i.bind(this),this.$fiery.destroy=o.bind(this),this.$fiery.getMetadata=function(t){return s.getMetadata(e,t)},this.$fires={}}function o(){this.$fiery.stores={},this.$fiery.entry={},this.$fiery.entryList.forEach(c.closeEntry),this.$fiery.entryList=[],this.$fiery=function(){},this.$fires={}}function i(){for(var e=this.$fiery.entryList,t=0;t<e.length;t++){var r=e[t];if(null!==r){var n=r.options;if(!n.parent&&!n.property)for(var o in this)if(this[o]===r.target){n.property=o,this.$fiery.entry[o]=r,this.$fires[o]=r.source;break}}}}Object.defineProperty(t,"__esModule",{value:!0});var s=r(3),c=r(5),u=r(7),a=r(9);t.init=n,t.destroy=o,t.link=i},function(e,t,r){"use strict";function n(e){return"[object Object]"===Object.prototype.toString.call(e)}function o(e){return"function"==typeof e}function i(e){return e&&e instanceof Array}function s(e){return!!e.where}function c(e,t){if(i(e)){for(var r=0;r<e.length;r++)t(e[r],r,e);return!0}if(n(e)){for(var o in e)t(e[o],o,e);return!0}return!1}function u(e,t){var r=t[d.PROP_UID],n=r.split(d.UID_SEPARATOR),o=n[0],i=n[1],s=n[2],c=e.$fiery.stores[parseInt(o)],u=e.$fiery.options[parseInt(i)];return{uid:r,path:s,storeKey:o,store:c,optionKey:i,options:u}}function a(e,t){if(t.record){var r=t.recordOptions,n=t.recordFunctions;r.sync&&(e[r.sync]=n.sync),r.update&&(e[r.update]=n.update),r.remove&&(e[r.remove]=n.remove),r.clear&&(e[r.clear]=n.clear),r.getChanges&&(e[r.getChanges]=n.getChanges),r.ref&&(e[r.ref]=n.ref)}return e}function f(e,t){if(e===t)return!0;if(!e||!t)return!1;if(i(e)&&i(t)){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!f(e[r],t[r]))return!1;return!0}if(n(e)&&n(t)){for(var o in e)if(!f(e[o],t[o]))return!1;for(var o in t)if(!(o in e))return!1;return!0}return!1}Object.defineProperty(t,"__esModule",{value:!0});var d=r(4);t.isObject=n,t.isFunction=o,t.isArray=i,t.isCollectionSource=s,t.forEach=c,t.getMetadata=u,t.createRecord=a,t.isEqual=f},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROP_VALUE=".value",t.PROP_UID=".uid",t.UID_SEPARATOR="///",t.ENTRY_SEPARATOR="/",t.STORE_SEPARATOR="/",t.RECORD_OPTIONS={sync:"$sync",update:"$update",remove:"$remove",ref:"$ref",clear:"$clear",getChanges:"$getChanges"}},function(e,t,r){"use strict";function n(e){e&&e.off&&(e.off(),delete e.off)}function o(e,t,r,o,c){void 0===c&&(c=!1);var u=c?r:s.getOptions(e,r,t),a=i.isCollectionSource(t)?u.newCollection():u.newDocument(),f=u.property,d=o||f||"",l=e.$fiery,p=e.$fires,y=l.entry[d],v={},h={source:t,options:u,target:a,children:v};return y&&(n(y),h.target=y.target),d&&d in l.entry||(h.index=l.entryList.length,l.entryList.push(h)),d&&(l.entry[d]=h),f&&(p[f]=t),h}Object.defineProperty(t,"__esModule",{value:!0});var i=r(3),s=r(6);t.closeEntry=n,t.getEntry=o},function(e,t,r){"use strict";function n(e,t,r){if(t&&i.isObject(t)||(t={}),i.isFunction(t.onError)||(t.onError=function(e){}),i.isFunction(t.onMissing)||(t.onMissing=function(){}),i.isFunction(t.onSuccess)||(t.onSuccess=function(e){}),i.isFunction(t.onRemove)||(t.onRemove=function(){}),t.liveOptions||(t.liveOptions={}),t.propValue||(t.propValue=o.PROP_VALUE),t.recordOptions||(t.recordOptions=o.RECORD_OPTIONS),t.record&&(t.recordFunctions={sync:function(t){return s.sync.call(e,this,t)},update:function(t){return s.update.call(e,this,t)},remove:function(t){return void 0===t&&(t=!1),s.remove.call(e,this,t)},ref:function(t){return s.ref.call(e,this,t)},clear:function(t){return s.clear.call(e,this,t)},getChanges:function(t,r,n){return s.getChanges.call(e,this,t,r,n)}}),t.type){var c=t.type;t.newDocument=function(e){return new c}}else t.newDocument||(t.newDocument=function(e){return{}});if(t.newCollection||(t.newCollection=t.map?function(){return{}}:function(){return[]}),t.exclude){if(i.isArray(t.exclude)){var u=t.exclude;t.exclude={};for(var a=0;a<u.length;a++)t.exclude[u[a]]=!0}}else t.exclude={},t.key&&(t.exclude[t.key]=!0);var f=t.exclude;f[t.propValue]=!0,f[o.PROP_UID]=!0;for(var d in t.recordOptions)f[t.recordOptions[d]]=!0;if(t.sub)for(var l in t.sub){var p=n(e,t.sub[l]);p.property=l,p.parent=t,t.sub[l]=p,f[l]=!0}if(!t.id){var y=e.$fiery;t.id=++y.optionKeyNext,y.options[t.id]=t}return t}Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),i=r(3),s=r(7);t.getOptions=n},function(e,t,r){"use strict";function n(e,t){var r=d.getMetadata(this,e),n=r.store,o=r.path,i=r.options;if(n&&o){var s=a(e,i,t);return n.doc(o).update(s)}}function o(e,t){var r=d.getMetadata(this,e),n=r.store,o=r.path,i=r.options;if(n&&o){var s=a(e,i,t);return n.doc(o).set(s)}}function i(e,t){var r=this;void 0===t&&(t=!1);var n=d.getMetadata(this,e),o=n.store,i=n.path,s=n.options;if(o&&i){if(!t&&s.sub)for(var c in s.sub)d.forEach(e[c],function(e){r.remove(e)});return o.doc(i).delete()}}function s(e,t){var r=this,n=d.getMetadata(this,e),o=n.store,i=n.path,s=n.options,c=t instanceof Array?t:[t];if(o&&i){for(var u=o.doc(i),a={},f=0,l=0,p=c;l<p.length;l++){var y=p[l];if(s.sub&&y in s.sub&&e[y])d.forEach(e[y],function(e){r.remove(e)});else if(y in e){var v=o.app.firebase_;v&&(a[y]=v.firestore.FieldValue.delete(),f++)}}if(f>0)return u.update(a)}}function c(e,t,r,n){var o=d.getMetadata(this,e),i=o.store,s=o.path,c=o.options,u="string"==typeof t?t:void 0,l=u?r:t,p=(u?n:r)||d.isEqual;if(i&&s){var y=a(e,c,u);return i.doc(s).get().then(function(e){var t=f.parseDocument(e,c),r={},n={},o=!1;for(var i in y){var s=t[i],u=y[i];p(u,s)||(o=!0,r[i]=s,n[i]=u)}l(o,r,n)})}}function u(e,t){var r=d.getMetadata(this,e),n=r.store,o=r.path;if(n&&o){var i=n.doc(o);return t?i.collection(t):i}}function a(e,t,r){var n=r||t.include,o={};if(n)for(var i=0;i<n.length;i++){var s=n[i];s in e&&(o[s]=e[s])}else for(var s in e)s in t.exclude||(o[s]=e[s]);return o}Object.defineProperty(t,"__esModule",{value:!0});var f=r(8),d=r(3);t.update=n,t.sync=o,t.remove=i,t.clear=s,t.getChanges=c,t.ref=u,t.getValues=a},function(e,t,r){"use strict";function n(e,t){var r,n=e.data(),o=d.isObject(n)?n:(r={},r[t.propValue]=n,r);return o&&t.key&&(o[t.key]=e.id),o}function o(e,t,r,o){var s=t.options,c=s.property,a=!(!s.reset||!c),y=n(r,s);if(o)if(a){var v=s.newDocument(y);if(s.sub)for(var h in s.sub)o[h]&&(v[h]=o[h]);d.createRecord(v,s),o=i(e,v,y)}else i(e,o,y);else{var g=u(e,s,r);if(o=s.newDocument(y),o[f.PROP_UID]=g,i(e,o,y),d.createRecord(o,s),s.sub)for(var h in s.sub){var O=s.sub[h],b=r.ref.path+f.ENTRY_SEPARATOR+h,m=l.getEntry(e,r.ref.collection(h),O,b,!0);o[h]=p.factory(e,m)}}return o}function i(e,t,r){for(var n in r)e.$set(t,n,r[n]);return t}function s(e,t,r){for(var n in t){var o=t[n];c(e,o),r&&e.$delete(r,n)}}function c(e,t){var r=d.getMetadata(e,t),n=r.path,o=r.options;if(o.sub){var i=e.$fiery;for(var s in o.sub){var u=n+f.ENTRY_SEPARATOR+s,a=i.entry[u];a&&(l.closeEntry(a),delete i.entry[u],"number"==typeof a.index&&(i.entryList[a.index]=null,delete a.index)),d.forEach(t[s],function(t){c(e,t)})}}}function u(e,t,r){return a(e,r)+f.UID_SEPARATOR+t.id+f.UID_SEPARATOR+r.ref.path}function a(e,t){var r=t._firestore,n=r._databaseId,o=n.database+f.STORE_SEPARATOR+n.projectId,i=e.$fiery,s=i.storeIdToKey[o];return s||(s=++i.storeKeyNext,i.stores[s]=r,i.storeIdToKey[o]=s),s}Object.defineProperty(t,"__esModule",{value:!0});var f=r(4),d=r(3),l=r(5),p=r(9);t.parseDocument=n,t.refreshDocument=o,t.copyData=i,t.destroyDocuments=s,t.destroyDocument=c,t.getDocumentIdentifier=u,t.getStoreKey=a},function(e,t,r){"use strict";function n(e,t){var r=t.source.where?t.options.map?c.default:u.default:s.default;return r(e,t)}function o(e){return function(t,r){return n(e,i.getEntry(e,t,r))}}Object.defineProperty(t,"__esModule",{value:!0});var i=r(5),s=r(10),c=r(11),u=r(12);t.factory=n,t.factoryInstance=o,t.default=n},function(e,t,r){"use strict";function n(e,t){var r=t.source,n=t.options;return n.once?t.promise=r.get(n.onceOptions).then(function(r){o(e,t,r)}).catch(n.onError):t.off=r.onSnapshot(n.liveOptions,function(r){o(e,t,r)},n.onError),t.target}function o(e,t,r){var n=t.options;r.exists?(t.target=i.refreshDocument(e,t,r,t.target),n.reset&&n.property&&(e[n.property]=t.target),n.onSuccess(t.target)):n.onMissing()}Object.defineProperty(t,"__esModule",{value:!0});var i=r(8);t.factory=n,t.handleDocumentUpdate=o,t.default=n},function(e,t,r){"use strict";function n(e,t){var r=t.options,n=r.query?r.query(t.source):t.source;return r.once?t.promise=n.get(r.onceOptions).then(function(n){var i=t.target,s={};for(var c in i)s[c]=i[c];n.forEach(function(r){var n=i[r.id],c=o.refreshDocument(e,t,r,n);e.$set(i,r.id,c),delete s[r.id]},r.onError),o.destroyDocuments(e,s,i),r.onSuccess(i)}).catch(r.onError):t.off=n.onSnapshot(r.liveOptions,function(n){var i=t.target;n.docChanges().forEach(function(r){var n=r.doc;switch(r.type){case"modified":case"added":var s=i[n.id],c=o.refreshDocument(e,t,n,s);e.$set(i,n.id,c);break;case"removed":o.destroyDocument(e,i[n.id]),e.$delete(i,n.id)}},r.onError),r.onSuccess(i)},r.onError),t.target}Object.defineProperty(t,"__esModule",{value:!0});var o=r(8);t.default=n},function(e,t,r){"use strict";function n(e,t){var r=t.options,n=r.query?r.query(t.source):t.source;return r.once?t.promise=n.get(r.onceOptions).then(function(n){for(var s=t.target,c={},u=0;u<s.length;u++){var a=s[u];c[a[o.PROP_UID]]=a}s.splice(0,s.length),n.forEach(function(r){var n=c[r.id],u=i.refreshDocument(e,t,r,n);s.push(u),delete c[u[o.PROP_UID]]},r.onError),i.destroyDocuments(e,c),r.onSuccess(s)}).catch(r.onError):t.off=n.onSnapshot(r.liveOptions,function(n){var o=t.target;n.docChanges().forEach(function(r){var n=r.doc;switch(r.type){case"added":var s=i.refreshDocument(e,t,n);o.splice(r.newIndex,0,s);break;case"removed":o.splice(r.oldIndex,1);break;case"modified":var c=o[r.oldIndex],u=i.refreshDocument(e,t,n,c);r.oldIndex!==r.newIndex?(o.splice(r.oldIndex,1),o.splice(r.newIndex,0,u)):o.splice(r.newIndex,1,u)}},r.onError),r.onSuccess(o)},r.onError),t.target}Object.defineProperty(t,"__esModule",{value:!0});var o=r(4),i=r(8);t.factory=n,t.default=n}])});
//# sourceMappingURL=vue-fiery.js.map